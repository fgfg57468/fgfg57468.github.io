<script src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/galleria/1.6.1/galleria.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/lib/marked.umd.js"></script>

<style>
    .galleria { 
        width: 100%; 
        max-width: 800px;
        height: 500px; 
        margin: 20px auto;
        display: block; 
        background: #fff;
    }
    
    .post-group { 
        margin: 30px 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
    }
    
    .main-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .gallery-wrapper {
        width: 100%;
        display: flex;
        justify-content: center;
    }
    
    .loading {
        text-align: center;
        padding: 20px;
        color: #666;
    }
    
    .error {
        color: red;
        text-align: center;
        padding: 20px;
    }
</style>

<head>
    <script>
        const WORKER_URL = 'https://aged-term-4c5f.fgfg57468.workers.dev'; // Замени на свой URL Worker
        
        window.onload = async function() {
            try {
                const response = await fetch(`${WORKER_URL}/ipfs-content`);
                if (!response.ok) throw new Error('Failed to fetch from Worker');
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                createImageGallery(data.images);
                displayContent(data.content);

                Galleria.loadTheme('https://cdnjs.cloudflare.com/ajax/libs/galleria/1.6.1/themes/folio/galleria.folio.min.js');
                Galleria.run('.galleria', { theme: 'folio' });

            } catch (error) {
                console.error('Ошибка:', error.message);
                showError(error.message);
            }
        };

        function createImageGallery(imageUrls) {
            const post_content = document.querySelector('.post-content');
            if (!post_content) {
                console.error('Element .post-content not found');
                return;
            }
            
            const gallery = document.createElement('div');
            const context = document.createElement('div');
            
            context.classList.add('post-group');
            gallery.classList.add('galleria');
            
            context.appendChild(gallery);
            post_content.appendChild(context);
            
            imageUrls.forEach((src, index) => {
                const img = document.createElement('img');
                img.src = src;
                img.alt = `Изображение ${index + 1}`;
                gallery.appendChild(img);
            });
        }
        
        function displayContent(content) {
            const post_content = document.querySelector('.post-content');
            if (!post_content) return;
            
            // Если нужно отобразить текстовый контент
            const contentElement = document.createElement('div');
            contentElement.innerHTML = marked.parse(content || '');
            post_content.appendChild(contentElement);
        }
        
        function showError(message) {
            const post_content = document.querySelector('.post-content');
            if (!post_content) return;
            
            const errorElement = document.createElement('div');
            errorElement.className = 'error';
            errorElement.textContent = `Ошибка: ${message}`;
            post_content.appendChild(errorElement);
        }
    </script>
</head>

<body>
    <div class="main-container">
        <div class="post-content">
            <div class="loading">Загрузка контента через Cloudflare Worker...</div>
        </div>
    </div>
</body>
